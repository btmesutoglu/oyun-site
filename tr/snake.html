<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Yƒ±lan | Mini Oyunlar</title>
  <style>
    :root{
      --bg1:#070b1c;
      --bg2:#0a1838;
      --card:#0b1430cc;
      --card2:#0b1430aa;
      --stroke:#ffffff1a;
      --text:#eaf1ff;
      --muted:#b7c6e6;
      --btn:#121e42;
      --btn2:#172a59;
      --accent:#48a7ff;
      --good:#35d07f;
      --food:#ff4e57;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, #0b2a66 0%, transparent 60%),
        radial-gradient(900px 500px at 85% 15%, #1a2c5a 0%, transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    a{ color:inherit; text-decoration:none; }

    /* Topbar */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, #050a18cc, #050a1800);
      border-bottom: 1px solid var(--stroke);
    }
    .topbarInner{
      max-width: 1200px;
      margin: 0 auto;
      padding: 14px 18px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800; letter-spacing: .2px;
    }
    .brand .emoji{ font-size: 20px; }
    .brand .title{ font-size: 16px; opacity:.95; }
    .nav{
      display:flex; align-items:center; gap:10px;
      color: var(--muted);
      font-weight:600;
    }
    .nav a{
      padding: 10px 12px;
      border-radius: 12px;
      background: #0a1430aa;
      border: 1px solid var(--stroke);
    }
    .nav a:hover{ background:#0a1430ee; }

    /* Layout */
    .layout{
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px;
      display:grid;
      grid-template-columns: minmax(280px, 1fr) 380px;
      gap: 16px;
      align-items: start;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: 0 20px 60px #00000055;
    }

    .gameCard{
      padding: 16px;
    }

    .headerBlock{
      text-align:center;
      padding: 6px 10px 14px;
    }
    .headerBlock h1{
      margin: 10px 0 6px;
      font-size: clamp(26px, 3vw, 40px);
      letter-spacing: .3px;
    }
    .stats{
      display:flex;
      justify-content:center;
      gap: 16px;
      flex-wrap: wrap;
      color: var(--muted);
      font-weight:700;
    }
    .stat strong{ color: var(--text); }

    /* Board wrapper keeps it square & responsive */
    .boardWrap{
      width: 100%;
      max-width: 720px;
      margin: 0 auto;
      aspect-ratio: 1 / 1;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, #081432, #061028);
      position: relative;
      touch-action: none; /* allow swipe detection */
    }
    canvas{
      width: 100%;
      height: 100%;
      display:block;
    }

    /* Panel */
    .panel{
      padding: 16px;
      position: sticky;
      top: 76px;
    }
    .panel h2{
      margin: 8px 0 12px;
      font-size: 18px;
      color: var(--muted);
      font-weight: 800;
      letter-spacing: .2px;
    }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
    }

    .btn{
      background: linear-gradient(180deg, var(--btn2), var(--btn));
      border: 1px solid var(--stroke);
      color: var(--text);
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 800;
      cursor:pointer;
      user-select:none;
      min-width: 110px;
      text-align:center;
    }
    .btn:hover{ filter: brightness(1.08); }
    .btn:active{ transform: translateY(1px); }
    .btn[disabled]{
      opacity: .45;
      cursor:not-allowed;
      transform:none;
    }

    .speedBox{
      margin-top: 14px;
      padding: 12px;
      border-radius: 16px;
      background: var(--card2);
      border: 1px solid var(--stroke);
    }
    .speedLine{
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .pill{
      width: 46px;
      height: 42px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: #0a1430cc;
      color: var(--text);
      font-weight:900;
      cursor:pointer;
    }
    .pill:active{ transform: translateY(1px); }
    input[type="range"]{
      width: 100%;
      accent-color: var(--accent);
    }

    /* D-Pad */
    .dpadWrap{
      margin-top: 14px;
      padding: 12px;
      border-radius: 16px;
      background: var(--card2);
      border: 1px solid var(--stroke);
    }
    .dpad{
      margin: 10px auto 0;
      display:grid;
      grid-template-columns: 76px 76px 76px;
      grid-template-rows: 76px 76px 76px;
      gap: 12px;
      justify-content:center;
      align-items:center;
      width: max-content;
    }
    .dpad button{
      width: 76px;
      height: 76px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: #0a1430cc;
      color: var(--text);
      font-size: 20px;
      font-weight: 900;
      cursor: pointer;
    }
    .dpad button:hover{ filter: brightness(1.08); }
    .dpad button:active{ transform: translateY(1px); }
    .dpad .empty{ visibility:hidden; }

    .help{
      margin-top: 14px;
      color: var(--muted);
      font-weight: 700;
      line-height: 1.35;
      font-size: 13px;
    }

    .toast{
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: #0a1430cc;
      color: var(--muted);
      font-weight: 700;
      min-height: 44px;
    }

    /* Mobile layout: stack and keep panel close */
    @media (max-width: 900px){
      .layout{
        grid-template-columns: 1fr;
        padding: 14px;
      }
      .panel{
        position: static;
        max-width: 720px;
        margin: 0 auto;
        padding-bottom: calc(14px + env(safe-area-inset-bottom));
      }
      .btn{ flex: 1; min-width: 0; }
      .row{ gap: 10px; }
      .dpad{
        grid-template-columns: 70px 70px 70px;
        grid-template-rows: 70px 70px 70px;
        gap: 10px;
      }
      .dpad button{
        width: 70px;
        height: 70px;
      }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbarInner">
      <div class="brand">
        <span class="emoji">üêç</span>
        <span class="title">Yƒ±lan</span>
      </div>
      <nav class="nav">
        <a href="./index.html">‚Üê Ana Sayfa</a>
      </nav>
    </div>
  </header>

  <main class="layout">
    <!-- GAME -->
    <section class="card gameCard">
      <div class="headerBlock">
        <h1>Yƒ±lan</h1>
        <div class="stats">
          <div class="stat">Skor: <strong id="score">0</strong></div>
          <div class="stat">Rekor: <strong id="best">0</strong></div>
          <div class="stat">Hƒ±z: <strong id="speedLabel">8</strong></div>
        </div>
      </div>

      <div class="boardWrap" id="boardWrap" aria-label="Yƒ±lan oyun alanƒ±">
        <canvas id="game"></canvas>
      </div>
    </section>

    <!-- PANEL -->
    <aside class="card panel">
      <h2>Kontroller</h2>

      <div class="row">
        <button class="btn" id="btnStart">Ba≈ülat</button>
        <button class="btn" id="btnPause" disabled>Duraklat</button>
        <button class="btn" id="btnRestart" disabled>Yeniden</button>
      </div>

      <div class="speedBox">
        <div class="speedLine">
          <strong style="color:var(--muted);min-width:40px;">Hƒ±z</strong>
          <button class="pill" id="btnMinus" aria-label="Hƒ±zƒ± azalt">‚àí</button>
          <input id="speed" type="range" min="3" max="18" value="8" />
          <button class="pill" id="btnPlus" aria-label="Hƒ±zƒ± artƒ±r">+</button>
        </div>
      </div>

      <div class="dpadWrap">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
          <strong style="color:var(--muted);">Y√∂n Tu≈ülarƒ±</strong>
          <span style="color:var(--muted);font-weight:700;font-size:12px;">(Mobil i√ßin ideal)</span>
        </div>
        <div class="dpad">
          <button class="empty" tabindex="-1"> </button>
          <button data-dir="up" aria-label="Yukarƒ±">‚ñ≤</button>
          <button class="empty" tabindex="-1"> </button>

          <button data-dir="left" aria-label="Sol">‚óÄ</button>
          <button class="empty" tabindex="-1"> </button>
          <button data-dir="right" aria-label="Saƒü">‚ñ∂</button>

          <button class="empty" tabindex="-1"> </button>
          <button data-dir="down" aria-label="A≈üaƒüƒ±">‚ñº</button>
          <button class="empty" tabindex="-1"> </button>
        </div>
      </div>

      <div class="help">
        <div><b>Masa√ºst√º:</b> Ok tu≈ülarƒ± / WASD</div>
        <div><b>Mobil:</b> Y√∂n tu≈ülarƒ± veya oyun alanƒ±nda kaydƒ±r (swipe)</div>
        <div><b>ƒ∞pucu:</b> Hƒ±zƒ± slider ya da +/‚àí ile ayarla</div>
      </div>

      <div class="toast" id="toast">Hazƒ±r. Ba≈ülat‚Äôa bas.</div>
    </aside>
  </main>

  <script>
    // ====== Helpers ======
    const $ = (id) => document.getElementById(id);

    const canvas = $("game");
    const wrap = $("boardWrap");
    const ctx = canvas.getContext("2d");

    const scoreEl = $("score");
    const bestEl  = $("best");
    const speedEl = $("speed");
    const speedLabel = $("speedLabel");
    const toastEl = $("toast");

    const btnStart = $("btnStart");
    const btnPause = $("btnPause");
    const btnRestart = $("btnRestart");
    const btnMinus = $("btnMinus");
    const btnPlus  = $("btnPlus");

    // localStorage best score
    const LS_BEST = "snake_best_tr";
    let best = Number(localStorage.getItem(LS_BEST) || "0");
    bestEl.textContent = String(best);

    // ====== Game State ======
    const GRID = 20;          // 20x20
    let cell = 0;             // computed from canvas size
    let snake = [];
    let dir = {x:1,y:0};
    let nextDir = {x:1,y:0};
    let food = {x:10,y:10};
    let score = 0;

    let running = false;
    let paused  = false;
    let gameOver = false;

    // speed: higher = faster. We'll map to interval ms.
    let speed = Number(speedEl.value); // 3..18
    let timer = null;

    // ====== Responsive canvas ======
    function resizeCanvas(){
      // ensure square
      const size = wrap.clientWidth;
      canvas.width  = Math.floor(size);
      canvas.height = Math.floor(size);
      cell = canvas.width / GRID;
      draw();
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // ====== Rendering ======
    function drawGrid(){
      // background
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // soft bg
      const g = ctx.createLinearGradient(0,0,0,canvas.height);
      g.addColorStop(0, "#071432");
      g.addColorStop(1, "#051028");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // grid lines
      ctx.strokeStyle = "rgba(255,255,255,0.06)";
      ctx.lineWidth = 1;
      for(let i=1;i<GRID;i++){
        const p = i * cell;
        ctx.beginPath(); ctx.moveTo(p,0); ctx.lineTo(p,canvas.height); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0,p); ctx.lineTo(canvas.width,p); ctx.stroke();
      }
    }

    function drawFood(){
      const x = food.x * cell;
      const y = food.y * cell;
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue("--food").trim() || "#ff4e57";
      ctx.fillRect(x+2, y+2, cell-4, cell-4);
    }

    function drawSnake(){
      const good = getComputedStyle(document.documentElement).getPropertyValue("--good").trim() || "#35d07f";
      snake.forEach((p, idx) => {
        ctx.fillStyle = idx === 0 ? "#61ffb0" : good;
        ctx.fillRect(p.x*cell+2, p.y*cell+2, cell-4, cell-4);
      });
    }

    function draw(){
      drawGrid();
      drawFood();
      drawSnake();
    }

    // ====== Game Logic ======
    function randCell(){
      return Math.floor(Math.random()*GRID);
    }

    function placeFood(){
      while(true){
        const fx = randCell();
        const fy = randCell();
        const hit = snake.some(p => p.x===fx && p.y===fy);
        if(!hit){
          food = {x:fx, y:fy};
          return;
        }
      }
    }

    function resetState(){
      score = 0;
      scoreEl.textContent = "0";
      dir = {x:1,y:0};
      nextDir = {x:1,y:0};
      snake = [
        {x: Math.floor(GRID/2), y: Math.floor(GRID/2)},
        {x: Math.floor(GRID/2)-1, y: Math.floor(GRID/2)},
        {x: Math.floor(GRID/2)-2, y: Math.floor(GRID/2)}
      ];
      placeFood();
      gameOver = false;
      paused = false;
      draw();
    }

    function setToast(msg){
      toastEl.textContent = msg;
    }

    function speedToInterval(s){
      // s: 3..18 -> ms: slower to faster
      // 3 => 260ms, 18 => 70ms
      const ms = Math.round(310 - (s*13));
      return Math.max(60, Math.min(320, ms));
    }

    function updateSpeedUI(){
      speed = Number(speedEl.value);
      speedLabel.textContent = String(speed);
      if(running && !paused){
        startLoop(); // restart timer with new speed
      }
    }

    function isOpposite(a, b){
      return a.x === -b.x && a.y === -b.y;
    }

    function step(){
      if(!running || paused || gameOver) return;

      // apply buffered direction (prevents instant reverse)
      if(!isOpposite(nextDir, dir)){
        dir = {...nextDir};
      }

      const head = snake[0];
      const nh = {x: head.x + dir.x, y: head.y + dir.y};

      // wall collision
      if(nh.x < 0 || nh.y < 0 || nh.x >= GRID || nh.y >= GRID){
        lose();
        return;
      }

      // self collision
      if(snake.some((p, idx) => idx !== 0 && p.x===nh.x && p.y===nh.y)){
        lose();
        return;
      }

      snake.unshift(nh);

      // eat
      if(nh.x === food.x && nh.y === food.y){
        score++;
        scoreEl.textContent = String(score);
        if(score > best){
          best = score;
          bestEl.textContent = String(best);
          localStorage.setItem(LS_BEST, String(best));
        }
        placeFood();
      }else{
        snake.pop();
      }

      draw();
    }

    function lose(){
      gameOver = true;
      running = false;
      stopLoop();
      btnStart.disabled = false;
      btnPause.disabled = true;
      btnRestart.disabled = false;
      setToast("Oyun bitti! Yeniden ba≈ülatabilirsin.");
    }

    function startLoop(){
      stopLoop();
      timer = setInterval(step, speedToInterval(speed));
    }

    function stopLoop(){
      if(timer){
        clearInterval(timer);
        timer = null;
      }
    }

    // ====== Controls (buttons) ======
    btnStart.addEventListener("click", () => {
      if(gameOver || !snake.length){
        resetState();
      }
      running = true;
      paused = false;
      startLoop();

      btnStart.disabled = true;
      btnPause.disabled = false;
      btnRestart.disabled = false;

      setToast("Oyun ba≈üladƒ±. ƒ∞yi eƒülenceler!");
    });

    btnPause.addEventListener("click", () => {
      if(!running) return;
      paused = !paused;
      btnPause.textContent = paused ? "Devam" : "Duraklat";
      setToast(paused ? "Duraklatƒ±ldƒ±." : "Devam ediyor.");
    });

    btnRestart.addEventListener("click", () => {
      resetState();
      running = true;
      paused = false;
      btnPause.textContent = "Duraklat";
      btnStart.disabled = true;
      btnPause.disabled = false;
      btnRestart.disabled = false;
      startLoop();
      setToast("Yeniden ba≈üladƒ±!");
    });

    // Speed controls
    speedEl.addEventListener("input", updateSpeedUI);
    btnMinus.addEventListener("click", () => {
      speedEl.value = String(Math.max(Number(speedEl.min), Number(speedEl.value)-1));
      updateSpeedUI();
    });
    btnPlus.addEventListener("click", () => {
      speedEl.value = String(Math.min(Number(speedEl.max), Number(speedEl.value)+1));
      updateSpeedUI();
    });

    // D-pad clicks
    document.querySelectorAll(".dpad button[data-dir]").forEach(btn => {
      btn.addEventListener("click", () => {
        const d = btn.getAttribute("data-dir");
        applyDir(d);
      });
    });

    // Keyboard
    window.addEventListener("keydown", (e) => {
      const k = e.key.toLowerCase();
      if(["arrowup","arrowdown","arrowleft","arrowright","w","a","s","d"].includes(k)){
        e.preventDefault();
      }
      if(k === "arrowup" || k === "w") applyDir("up");
      if(k === "arrowdown" || k === "s") applyDir("down");
      if(k === "arrowleft" || k === "a") applyDir("left");
      if(k === "arrowright" || k === "d") applyDir("right");
      if(k === " "){
        // space pause/resume
        if(!btnPause.disabled) btnPause.click();
      }
    }, {passive:false});

    function applyDir(which){
      if(which === "up")    nextDir = {x:0,y:-1};
      if(which === "down")  nextDir = {x:0,y: 1};
      if(which === "left")  nextDir = {x:-1,y:0};
      if(which === "right") nextDir = {x: 1,y:0};
    }

    // Swipe on boardWrap
    let touchStart = null;
    wrap.addEventListener("touchstart", (e) => {
      if(!e.touches || !e.touches[0]) return;
      const t = e.touches[0];
      touchStart = {x: t.clientX, y: t.clientY, time: Date.now()};
    }, {passive:true});

    wrap.addEventListener("touchend", (e) => {
      if(!touchStart) return;
      const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
      if(!t) return;

      const dx = t.clientX - touchStart.x;
      const dy = t.clientY - touchStart.y;
      const adx = Math.abs(dx), ady = Math.abs(dy);

      // require minimum swipe distance
      const min = 24;
      if(Math.max(adx, ady) < min) return;

      if(adx > ady){
        applyDir(dx > 0 ? "right" : "left");
      }else{
        applyDir(dy > 0 ? "down" : "up");
      }
      touchStart = null;
    }, {passive:true});

    // Initialize
    resetState();
    updateSpeedUI();
    setToast("Hazƒ±r. Ba≈ülat‚Äôa bas.");
  </script>
</body>
</html>
