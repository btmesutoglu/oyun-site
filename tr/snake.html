<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Yƒ±lan</title>
  <style>
    :root{
      --bg0:#060a18;
      --bg1:#071432;
      --bg2:#091a3d;
      --card:#0b1430cc;
      --stroke:rgba(255,255,255,.10);
      --text:#eaf1ff;
      --muted:#b8c7ea;
      --btn:#0d1736;
      --btn2:#13224c;
      --accent:#4aa8ff;
      --snake:#33d17a;
      --snakeHead:#61ffb0;
      --food:#ff4e57;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 20% 10%, #0b2a66 0%, transparent 60%),
        radial-gradient(900px 500px at 85% 15%, #1a2c5a 0%, transparent 55%),
        linear-gradient(180deg,var(--bg0),var(--bg1),var(--bg2));
    }
    a{color:inherit;text-decoration:none}
    .topbar{
      position:sticky;top:0;z-index:10;
      backdrop-filter:blur(10px);
      background:linear-gradient(180deg,#050a18cc,#050a1800);
      border-bottom:1px solid var(--stroke);
    }
    .topbarIn{
      max-width:1200px;margin:0 auto;padding:14px 18px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    .brand .emoji{font-size:20px}
    .nav a{
      padding:10px 12px;border-radius:12px;
      background:#0a1430aa;border:1px solid var(--stroke);
      color:var(--muted);font-weight:700;
    }
    .nav a:hover{background:#0a1430ee}
    .wrap{
      max-width:1200px;margin:0 auto;padding:18px;
      display:grid;grid-template-columns:minmax(280px,1fr) 380px;
      gap:16px;align-items:start;
    }
    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:18px;
      box-shadow:0 18px 55px rgba(0,0,0,.45);
    }
    .gameCard{padding:16px}
    .header{text-align:center;padding:6px 8px 14px}
    .header h1{
      margin:10px 0 6px;
      font-size:clamp(26px,3vw,40px);
      letter-spacing:.2px;
    }
    .stats{
      display:flex;justify-content:center;flex-wrap:wrap;
      gap:14px;color:var(--muted);font-weight:800;
    }
    .stats strong{color:var(--text)}
    .boardWrap{
      width:100%;
      max-width:720px;
      margin:0 auto;
      aspect-ratio:1/1;
      border-radius:16px;
      overflow:hidden;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg,#071432,#051028);
      touch-action:none; /* swipe */
    }
    canvas{width:100%;height:100%;display:block}

    .panel{padding:16px;position:sticky;top:76px}
    .panel h2{margin:8px 0 12px;font-size:18px;color:var(--muted);font-weight:900}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      flex:1;
      padding:12px 14px;border-radius:14px;
      background:linear-gradient(180deg,var(--btn2),var(--btn));
      border:1px solid var(--stroke);
      color:var(--text);font-weight:900;cursor:pointer;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.07)}
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{opacity:.45;cursor:not-allowed;transform:none}

    .box{
      margin-top:14px;padding:12px;border-radius:16px;
      background:rgba(11,20,48,.65);
      border:1px solid var(--stroke);
    }
    .speedLine{display:flex;align-items:center;gap:10px}
    .pill{
      width:46px;height:42px;border-radius:14px;
      background:#0a1430cc;border:1px solid var(--stroke);
      color:var(--text);font-weight:900;cursor:pointer;
    }
    input[type="range"]{width:100%;accent-color:var(--accent)}

    .dpad{
      margin:10px auto 0;
      display:grid;
      grid-template-columns:74px 74px 74px;
      grid-template-rows:74px 74px 74px;
      gap:12px;
      justify-content:center;
      width:max-content;
    }
    .dpad button{
      width:74px;height:74px;border-radius:16px;
      background:#0a1430cc;border:1px solid var(--stroke);
      color:var(--text);font-size:20px;font-weight:900;
      cursor:pointer;
    }
    .dpad button:hover{filter:brightness(1.07)}
    .dpad button:active{transform:translateY(1px)}
    .dpad .empty{visibility:hidden}

    .help{
      margin-top:14px;color:var(--muted);
      font-weight:750;font-size:13px;line-height:1.35;
    }
    .toast{
      margin-top:12px;
      padding:10px 12px;border-radius:14px;
      background:#0a1430cc;border:1px solid var(--stroke);
      color:var(--muted);font-weight:800;min-height:44px;
    }

    /* Mobile: stack; panel stays close and not ‚Äúdown somewhere‚Äù */
    @media (max-width: 900px){
      .wrap{grid-template-columns:1fr;padding:14px}
      .panel{position:static;max-width:720px;margin:0 auto;
        padding-bottom:calc(14px + env(safe-area-inset-bottom))}
      .dpad{
        grid-template-columns:68px 68px 68px;
        grid-template-rows:68px 68px 68px;
        gap:10px;
      }
      .dpad button{width:68px;height:68px}
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topbarIn">
      <div class="brand"><span class="emoji">üêç</span> <span>Yƒ±lan</span></div>
      <nav class="nav"><a href="../index.html">‚Üê Ana Sayfa</a></nav>
    </div>
  </header>

  <main class="wrap">
    <section class="card gameCard">
      <div class="header">
        <h1>Yƒ±lan</h1>
        <div class="stats">
          <div>Skor: <strong id="score">0</strong></div>
          <div>Rekor: <strong id="best">0</strong></div>
          <div>Hƒ±z: <strong id="speedLabel">8</strong></div>
        </div>
      </div>
      <div class="boardWrap" id="boardWrap">
        <canvas id="cv"></canvas>
      </div>
    </section>

    <aside class="card panel">
      <h2>Kontroller</h2>

      <div class="row">
        <button class="btn" id="start">Ba≈ülat</button>
        <button class="btn" id="pause" disabled>Duraklat</button>
        <button class="btn" id="restart" disabled>Yeniden</button>
      </div>

      <div class="box">
        <div class="speedLine">
          <strong style="color:var(--muted);min-width:40px;">Hƒ±z</strong>
          <button class="pill" id="minus">‚àí</button>
          <input id="speed" type="range" min="3" max="18" value="8" />
          <button class="pill" id="plus">+</button>
        </div>
      </div>

      <div class="box">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
          <strong style="color:var(--muted);">Y√∂n Tu≈ülarƒ±</strong>
          <span style="color:var(--muted);font-weight:750;font-size:12px;">Mobil i√ßin</span>
        </div>
        <div class="dpad">
          <button class="empty" tabindex="-1"></button>
          <button data-dir="up">‚ñ≤</button>
          <button class="empty" tabindex="-1"></button>

          <button data-dir="left">‚óÄ</button>
          <button class="empty" tabindex="-1"></button>
          <button data-dir="right">‚ñ∂</button>

          <button class="empty" tabindex="-1"></button>
          <button data-dir="down">‚ñº</button>
          <button class="empty" tabindex="-1"></button>
        </div>
      </div>

      <div class="help">
        <div><b>Masa√ºst√º:</b> Ok tu≈ülarƒ± / WASD</div>
        <div><b>Mobil:</b> Y√∂n tu≈ülarƒ± veya oyun alanƒ±nda kaydƒ±r (swipe)</div>
        <div><b>Bo≈üluk:</b> Duraklat/Devam</div>
      </div>

      <div class="toast" id="toast">Hazƒ±r. Ba≈ülat‚Äôa bas.</div>
    </aside>
  </main>

  <script>
    // ===== DOM
    const $ = (id)=>document.getElementById(id);
    const cv = $("cv");
    const wrap = $("boardWrap");
    const ctx = cv.getContext("2d");

    const scoreEl = $("score");
    const bestEl  = $("best");
    const speedEl = $("speed");
    const speedLabel = $("speedLabel");
    const toastEl = $("toast");

    const btnStart = $("start");
    const btnPause = $("pause");
    const btnRestart = $("restart");
    const btnMinus = $("minus");
    const btnPlus  = $("plus");

    // ===== Game config
    const GRID = 20; // 20x20
    const LS_BEST = "snake_best_tr_v2";

    // ===== State
    let cell = 0;
    let snake = [];
    let dir = {x:1,y:0};
    let queued = {x:1,y:0};
    let food = {x:10,y:10};
    let score = 0;
    let best = Number(localStorage.getItem(LS_BEST) || "0");

    let running = false;
    let paused = false;
    let over = false;

    let speed = Number(speedEl.value); // 3..18
    let loop = null;

    bestEl.textContent = String(best);

    // ===== Canvas sizing
    function resize(){
      const size = Math.floor(wrap.clientWidth);
      cv.width = size;
      cv.height = size;
      cell = cv.width / GRID;
      render();
    }
    window.addEventListener("resize", resize);
    resize();

    // ===== Render
    function render(){
      // bg
      ctx.clearRect(0,0,cv.width,cv.height);
      const g = ctx.createLinearGradient(0,0,0,cv.height);
      g.addColorStop(0,"#071432");
      g.addColorStop(1,"#051028");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,cv.width,cv.height);

      // grid
      ctx.strokeStyle = "rgba(255,255,255,0.06)";
      ctx.lineWidth = 1;
      for(let i=1;i<GRID;i++){
        const p = i*cell;
        ctx.beginPath(); ctx.moveTo(p,0); ctx.lineTo(p,cv.height); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0,p); ctx.lineTo(cv.width,p); ctx.stroke();
      }

      // food
      ctx.fillStyle = getVar("--food");
      ctx.fillRect(food.x*cell+2, food.y*cell+2, cell-4, cell-4);

      // snake
      snake.forEach((p, i)=>{
        ctx.fillStyle = i===0 ? getVar("--snakeHead") : getVar("--snake");
        ctx.fillRect(p.x*cell+2, p.y*cell+2, cell-4, cell-4);
      });
    }

    function getVar(name){
      return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    }

    // ===== Helpers
    function toast(msg){ toastEl.textContent = msg; }
    function rand(n){ return Math.floor(Math.random()*n); }
    function opposite(a,b){ return a.x===-b.x && a.y===-b.y; }

    function placeFood(){
      while(true){
        const fx = rand(GRID), fy = rand(GRID);
        if(!snake.some(s=>s.x===fx && s.y===fy)){
          food = {x:fx,y:fy};
          return;
        }
      }
    }

    function reset(){
      score = 0;
      scoreEl.textContent = "0";
      dir = {x:1,y:0};
      queued = {x:1,y:0};
      snake = [
        {x:Math.floor(GRID/2), y:Math.floor(GRID/2)},
        {x:Math.floor(GRID/2)-1, y:Math.floor(GRID/2)},
        {x:Math.floor(GRID/2)-2, y:Math.floor(GRID/2)}
      ];
      placeFood();
      over = false;
      paused = false;
      render();
    }

    function intervalFromSpeed(s){
      // 3 slow -> ~260ms, 18 fast -> ~70ms
      const ms = Math.round(310 - (s*13));
      return Math.max(60, Math.min(320, ms));
    }

    function setSpeed(val){
      speed = val;
      speedEl.value = String(val);
      speedLabel.textContent = String(val);
      if(running && !paused) startLoop();
    }

    function startLoop(){
      stopLoop();
      loop = setInterval(tick, intervalFromSpeed(speed));
    }
    function stopLoop(){
      if(loop){ clearInterval(loop); loop=null; }
    }

    function applyDir(which){
      if(which==="up") queued = {x:0,y:-1};
      if(which==="down") queued = {x:0,y:1};
      if(which==="left") queued = {x:-1,y:0};
      if(which==="right") queued = {x:1,y:0};
    }

    // ===== Game tick
    function tick(){
      if(!running || paused || over) return;

      if(!opposite(queued, dir)) dir = {...queued};

      const head = snake[0];
      const nh = {x:head.x+dir.x, y:head.y+dir.y};

      // wall
      if(nh.x<0 || nh.y<0 || nh.x>=GRID || nh.y>=GRID){
        endGame();
        return;
      }
      // self
      if(snake.some((p,i)=>i!==0 && p.x===nh.x && p.y===nh.y)){
        endGame();
        return;
      }

      snake.unshift(nh);

      // eat
      if(nh.x===food.x && nh.y===food.y){
        score++;
        scoreEl.textContent = String(score);
        if(score>best){
          best = score;
          bestEl.textContent = String(best);
          localStorage.setItem(LS_BEST, String(best));
        }
        placeFood();
      }else{
        snake.pop();
      }

      render();
    }

    function endGame(){
      over = true;
      running = false;
      stopLoop();
      btnStart.disabled = false;
      btnPause.disabled = true;
      btnRestart.disabled = false;
      btnPause.textContent = "Duraklat";
      toast("Oyun bitti! Yeniden ba≈ülatabilirsin.");
    }

    // ===== Buttons
    btnStart.addEventListener("click", ()=>{
      if(!snake.length || over) reset();
      running = true;
      paused = false;
      startLoop();

      btnStart.disabled = true;
      btnPause.disabled = false;
      btnRestart.disabled = false;
      btnPause.textContent = "Duraklat";
      toast("Oyun ba≈üladƒ±!");
    });

    btnPause.addEventListener("click", ()=>{
      if(!running) return;
      paused = !paused;
      btnPause.textContent = paused ? "Devam" : "Duraklat";
      toast(paused ? "Duraklatƒ±ldƒ±." : "Devam ediyor.");
    });

    btnRestart.addEventListener("click", ()=>{
      reset();
      running = true;
      paused = false;
      startLoop();

      btnStart.disabled = true;
      btnPause.disabled = false;
      btnRestart.disabled = false;
      btnPause.textContent = "Duraklat";
      toast("Yeniden ba≈üladƒ±!");
    });

    speedEl.addEventListener("input", ()=> setSpeed(Number(speedEl.value)));
    btnMinus.addEventListener("click", ()=> setSpeed(Math.max(3, speed-1)));
    btnPlus.addEventListener("click", ()=> setSpeed(Math.min(18, speed+1)));

    document.querySelectorAll("[data-dir]").forEach(b=>{
      b.addEventListener("click", ()=> applyDir(b.dataset.dir));
    });

    // ===== Keyboard
    window.addEventListener("keydown", (e)=>{
      const k = e.key.toLowerCase();
      if(["arrowup","arrowdown","arrowleft","arrowright","w","a","s","d"," "].includes(k)){
        e.preventDefault();
      }
      if(k==="arrowup" || k==="w") applyDir("up");
      if(k==="arrowdown" || k==="s") applyDir("down");
      if(k==="arrowleft" || k==="a") applyDir("left");
      if(k==="arrowright" || k==="d") applyDir("right");
      if(k===" " && !btnPause.disabled) btnPause.click();
    }, {passive:false});

    // ===== Swipe on canvas area
    let startTouch = null;
    wrap.addEventListener("touchstart", (e)=>{
      const t = e.touches?.[0]; if(!t) return;
      startTouch = {x:t.clientX, y:t.clientY};
    }, {passive:true});

    wrap.addEventListener("touchend", (e)=>{
      if(!startTouch) return;
      const t = e.changedTouches?.[0]; if(!t) return;

      const dx = t.clientX - startTouch.x;
      const dy = t.clientY - startTouch.y;
      const adx = Math.abs(dx), ady = Math.abs(dy);
      const min = 24;
      if(Math.max(adx, ady) < min) return;

      if(adx > ady) applyDir(dx>0 ? "right" : "left");
      else applyDir(dy>0 ? "down" : "up");

      startTouch = null;
    }, {passive:true});

    // ===== init
    reset();
    setSpeed(speed);
    toast("Hazƒ±r. Ba≈ülat‚Äôa bas.");
  </script>
</body>
</html>
